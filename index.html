<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Trash Bins Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; text-align: center; padding: 20px; }
        h1 { color: #333; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .bin-card {
            background: white; border-radius: 15px; width: 200px; padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.2s;
        }
        .bin-icon { font-size: 60px; margin-bottom: 10px; }
        .status { font-weight: bold; font-size: 24px; margin-top: 10px; }
        
        /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ: ‡∏õ‡∏Å‡∏ï‡∏¥ = ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß, ‡πÄ‡∏ï‡πá‡∏° = ‡πÅ‡∏î‡∏á */
        .normal { color: #2ecc71; } 
        .full { color: #e74c3c; animation: blink 1s infinite; } /* ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Å‡∏∞‡∏û‡∏£‡∏¥‡∏ö */
        
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <h1>üóëÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏¢‡∏∞‡πÄ‡∏ï‡πá‡∏° (IoT)</h1>
    <div class="container">
        <div class="bin-card"><h2 id="name-1">‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 1</h2><div class="bin-icon" id="icon-1">üóëÔ∏è</div><div class="status" id="status-1">...</div></div>
        <div class="bin-card"><h2 id="name-2">‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 2</h2><div class="bin-icon" id="icon-2">üóëÔ∏è</div><div class="status" id="status-2">...</div></div>
        <div class="bin-card"><h2 id="name-3">‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 3</h2><div class="bin-icon" id="icon-3">üóëÔ∏è</div><div class="status" id="status-3">...</div></div>
        <div class="bin-card"><h2 id="name-4">‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 4</h2><div class="bin-icon" id="icon-4">üóëÔ∏è</div><div class="status" id="status-4">...</div></div>
    </div>

    <script>
        // --- ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SUPABASE (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°) ---
        const SUPABASE_URL = 'https://ljatucqreqiazvgwjugp.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_Aoo9e4gK8_aQn1-GiKVOAA_WDf7iDS4'; // ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà Key ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function updateUI(id, isFull) {
            const statusElem = document.getElementById(`status-${id}`);
            const iconElem = document.getElementById(`icon-${id}`);
            
            // isFull = true ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏Ç‡∏¢‡∏∞‡πÄ‡∏ï‡πá‡∏° (Database ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô true)
            if (isFull) {
                statusElem.innerText = "‡∏Ç‡∏¢‡∏∞‡πÄ‡∏ï‡πá‡∏°! (Full)";
                statusElem.className = "status full";
                iconElem.innerText = "‚õî"; 
            } else {
                statusElem.innerText = "‡∏õ‡∏Å‡∏ï‡∏¥ (Normal)";
                statusElem.className = "status normal";
                iconElem.innerText = "‚úÖ"; 
            }
        }

        async function fetchInitialData() {
            const { data } = await supabase.from('bins').select('*').order('id');
            if (data) data.forEach(bin => updateUI(bin.id, bin.is_open));
        }

        supabase.channel('schema-db-changes')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'bins' }, 
            (payload) => updateUI(payload.new.id, payload.new.is_open))
            .subscribe();

        fetchInitialData();
    </script>

</body>
</html>