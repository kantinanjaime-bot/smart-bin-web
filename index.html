<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Trash Bins Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; text-align: center; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .bin-card {
            background: white; border-radius: 15px; width: 240px; padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: left;
        }
        .bin-card h2 { text-align: center; margin-top: 0; }
        
        .status-row { 
            display: flex; justify-content: space-between; align-items: center; 
            margin: 15px 0; padding: 10px; border-radius: 8px; background: #f8f9fa;
        }
        .label { font-size: 14px; color: #666; }
        .value { font-weight: bold; font-size: 16px; }

        /* ‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
        .text-green { color: #28a745; }
        .text-red { color: #dc3545; }
        .bg-alert { background-color: #ffeeba; animation: blink 1s infinite; }
        
        @keyframes blink { 50% { opacity: 0.6; } }
    </style>
</head>
<body>

    <h1>üóëÔ∏è ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h1>
    <div class="container" id="container">
        </div>

    <script>
        // --- ‚öôÔ∏è ‡πÉ‡∏™‡πà KEY ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
        const SUPABASE_URL = 'https://ljatucqreqiazvgwjugp.supabase.co'; 
        
        // ‡πÉ‡∏™‡πà Key ‡∏¢‡∏≤‡∏ß‡πÜ ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ (‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏µ‡∏î ' ‡∏´‡∏ô‡πâ‡∏≤-‡∏´‡∏•‡∏±‡∏á)
        const SUPABASE_KEY = 'sb_publishable_Aoo9e4gK8_aQn1-GiKVOAA_WDf7iDS4'; 

        // --- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏õ‡πá‡∏ô client ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ error ---
        const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î 4 ‡πÉ‡∏ö ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        const container = document.getElementById('container');
        for(let i=1; i<=4; i++) {
            container.innerHTML += `
                <div class="bin-card">
                    <h2>‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà ${i}</h2>
                    
                    <div class="status-row">
                        <span class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤:</span>
                        <span class="value" id="lid-${i}">...</span>
                    </div>

                    <div class="status-row" id="row-full-${i}">
                        <span class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏:</span>
                        <span class="value" id="full-${i}">...</span>
                    </div>
                </div>
            `;
        }

        function updateUI(id, isOpen, isFull) {
            // 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ù‡∏≤
            const lidElem = document.getElementById(`lid-${id}`);
            if (isOpen) {
                lidElem.innerHTML = 'üëê ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î';
                lidElem.className = 'value text-green';
            } else {
                lidElem.innerHTML = 'üîí ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà';
                lidElem.className = 'value';
            }

            // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏¢‡∏∞‡πÄ‡∏ï‡πá‡∏°
            const fullElem = document.getElementById(`full-${id}`);
            const rowFull = document.getElementById(`row-full-${id}`);
            
            if (isFull) {
                fullElem.innerHTML = '‚õî ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!';
                fullElem.className = 'value text-red';
                rowFull.classList.add('bg-alert'); 
            } else {
                fullElem.innerHTML = '‚úÖ ‡∏ß‡πà‡∏≤‡∏á';
                fullElem.className = 'value text-green';
                rowFull.classList.remove('bg-alert');
            }
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        async function fetchInitialData() {
            const { data } = await client.from('bins').select('*').order('id');
            if (data) data.forEach(bin => updateUI(bin.id, bin.is_open, bin.is_full));
        }

        // ‡∏ü‡∏±‡∏á Realtime
        client.channel('schema-db-changes')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'bins' }, 
            (payload) => {
                updateUI(payload.new.id, payload.new.is_open, payload.new.is_full);
            })
            .subscribe();

        fetchInitialData();
    </script>

</body>
</html>