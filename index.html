<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Trash Bins Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; text-align: center; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .bin-card {
            background: white; border-radius: 15px; width: 220px; padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .bin-icon { font-size: 60px; margin: 10px 0; }
        .status { font-weight: bold; font-size: 20px; padding: 8px; border-radius: 8px; }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) */
        .normal { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ï‡πá‡∏° (‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö) */
        .full { 
            color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; 
            animation: blink 1s infinite; 
        }
        @keyframes blink { 50% { opacity: 0.6; } }
    </style>
</head>
<body>

    <h1>üóëÔ∏è ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞</h1>
    <div class="container">
        <div class="bin-card" id="card-1">
            <h2>‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 1</h2>
            <div class="bin-icon">‚ôªÔ∏è</div>
            <div class="status" id="status-1">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>
        <div class="bin-card" id="card-2">
            <h2>‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 2</h2>
            <div class="bin-icon">‚ôªÔ∏è</div>
            <div class="status" id="status-2">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>
        <div class="bin-card" id="card-3">
            <h2>‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 3</h2>
            <div class="bin-icon">‚ôªÔ∏è</div>
            <div class="status" id="status-3">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>
        <div class="bin-card" id="card-4">
            <h2>‡∏ñ‡∏±‡∏á‡∏ó‡∏µ‡πà 4</h2>
            <div class="bin-icon">‚ôªÔ∏è</div>
            <div class="status" id="status-4">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>
    </div>

    <script>
        // --- ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SUPABASE ---
        const SUPABASE_URL = 'https://ljatucqreqiazvgwjugp.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_Aoo9e4gK8_aQn1-GiKVOAA_WDf7iDS4'; 

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function updateUI(id, isFull) {
            const statusElem = document.getElementById(`status-${id}`);
            
            if (isFull) {
                statusElem.innerText = "‚ö†Ô∏è ‡∏Ç‡∏¢‡∏∞‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß!";
                statusElem.className = "status full";
            } else {
                statusElem.innerText = "‚úÖ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥";
                statusElem.className = "status normal";
            }
        }

        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        supabase.from('bins').select('*').order('id').then(({ data }) => {
            if(data) data.forEach(bin => updateUI(bin.id, bin.is_open));
        });

        // ‡∏ü‡∏±‡∏á Realtime
        supabase.channel('schema-db-changes')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'bins' }, 
            (payload) => updateUI(payload.new.id, payload.new.is_open))
            .subscribe();
    </script>

</body>
</html>